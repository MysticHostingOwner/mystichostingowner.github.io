<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Whitelist - Strax Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--primary:#007BFF;--danger:#DC3545;--bg:#fff;--card:#f7f7f7;}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
body{background:var(--bg);}
header{background:var(--primary);color:#fff;display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;}
header nav a{color:#fff;margin-left:1rem;text-decoration:none;font-weight:600;}
header nav a.active{text-decoration:underline;}
.account{position:relative;}
.account button{background:transparent;border:none;color:#fff;font-weight:600;cursor:pointer;}
.dropdown{position:absolute;top:2.5rem;right:0;background:#fff;color:#000;border-radius:6px;display:none;box-shadow:0 2px 8px rgba(0,0,0,0.2);}
.dropdown a{display:block;padding:0.5rem 1rem;text-decoration:none;color:#000;}
.dropdown a:hover{background:#f0f0f0;}
.container{padding:2rem;max-width:1200px;margin:0 auto;}
.card{background:var(--card);padding:1.5rem;border-radius:10px;margin-bottom:1rem;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
button{padding:0.5rem 1rem;border:none;border-radius:6px;font-weight:600;cursor:pointer;}
button.add{background:var(--primary);color:#fff;margin-bottom:1rem;}
button.remove{background:var(--danger);color:#fff;margin-bottom:1rem;}
.whitelist-list{height:400px;overflow-y:auto;background:#f0f0f0;padding:1rem;border-radius:6px;font-family:monospace;}
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.2);transition:transform 0.3s ease-in-out;z-index:1000;}
.popup.active{transform:translate(-50%,-50%) scale(1);}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;z-index:999;}
.overlay.active{display:block;}
</style>
</head>
<body>
<header>
<div>
<nav>
<a href="home.html">Home</a>
<a href="whitelist.html" class="active">Whitelist</a>
<a href="console.html">Console</a>
</nav>
</div>
<div class="account">
<button onclick="toggleDropdown()">Shadow â–¼</button>
<div class="dropdown" id="account-dropdown">
<a href="#" onclick="changePassword()">Change Password</a>
<a href="#" onclick="logout()">Logout</a>
</div>
</div>
</header>

<div class="container">
<button class="add" onclick="openPopup('add-popup')">Add Player</button>
<button class="remove" onclick="openPopup('remove-popup')">Remove Player</button>
<div class="card whitelist-list" id="whitelist-list">Loading...</div>
</div>

<div class="overlay" id="overlay"></div>

<div class="popup" id="add-popup">
<h3>Add Player</h3>
<input type="text" id="add-discord" placeholder="Discord ID (optional)">
<input type="text" id="add-username" placeholder="Minecraft Username">
<button class="add" onclick="addPlayer()">Add</button>
<button onclick="closePopup('add-popup')">Close</button>
</div>

<div class="popup" id="remove-popup">
<h3>Remove Player</h3>
<input type="text" id="remove-discord" placeholder="Discord ID (optional)">
<input type="text" id="remove-username" placeholder="Minecraft Username">
<button class="remove" onclick="removePlayer()">Remove</button>
<button onclick="closePopup('remove-popup')">Close</button>
</div>

<script>
if(localStorage.getItem('user')!=='Shadow') window.location.href='login.html';
function toggleDropdown(){ document.getElementById('account-dropdown').style.display=document.getElementById('account-dropdown').style.display==='block'?'none':'block'; }
function changePassword(){ alert('Change password not implemented'); }
function logout(){ localStorage.removeItem('user'); window.location.href='login.html';}
function openPopup(id){document.getElementById(id).classList.add('active'); document.getElementById('overlay').classList.add('active');}
function closePopup(id){document.getElementById(id).classList.remove('active'); document.getElementById('overlay').classList.remove('active');}

// WebSocket live whitelist
let wsWhitelist = new WebSocket('wss://whitelist.underhost.org/ws/whitelist');
wsWhitelist.onmessage = e=>{ document.getElementById('whitelist-list').innerText=e.data; }

// Add player with validation
async function addPlayer(){
    const discord=document.getElementById('add-discord').value.trim();
    const username=document.getElementById('add-username').value.trim();
    if(!username) return alert('Username required');

    const res=await fetch(`https://whitelist.underhost.org/api/validate-username?username=${username}`);
    const data=await res.json();
    if(!data.valid){ alert('Invalid Minecraft username'); return; }

    const payload=discord?{discordId:discord,username}:{username};
    await fetch('https://whitelist.underhost.org/api/add',{
        method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
    });
    closePopup('add-popup');
}

async function removePlayer(){
    const discord=document.getElementById('remove-discord').value.trim();
    const username=document.getElementById('remove-username').value.trim();
    if(!discord && !username) return alert('Provide Discord ID or username');
    const payload={};
    if(discord) payload.discordId=discord;
    if(username) payload.username=username;
    await fetch('https://whitelist.underhost.org/api/remove',{
        method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
    });
    closePopup('remove-popup');
}
</script>
</body>
</html>
